%h3= "#{@user.name}#{@user.locked? ? " (locked)" : nil}"
%p
  =link_to("ğŸ‘ˆ Back", admin_users_url, class: "user-back btn btn-secondary")
  = link_to("ğŸ™‚ Profile", @user.profile_url, class: "user-profile-button btn btn-primary #{@user.profile_url ? "" : "hidden"}", target: "_blank")
  = link_to("ğŸ’¬ Chat", @user.chat_url, class: "user-chat-button btn btn-primary #{@user.chat_url ? "" : "hidden"}", target: "_blank")

- dataset = {url: admin_user_patch_url(token: @user.token), token: @token, id: @user.id, greeter_id: @user.greeter_id, status: @user.status, timestamp: @user.when_timestamp, shadow_id: @user.shadow_greeter_id}

%table.user.table.table-bordered.table-striped{ data: dataset }
  %tbody
    %tr
      %td.header Greeter
      %td.user-greeter
        = link_to((@user.greeter_id ? @user.greeter.name : "I want to greet"), "#")
    %tr
      %td.header Email
      %td.user-email= link_to @user.email, "mailto:#{ @user.email }"
    %tr
      %td.header Status
      %td.user-status
        %select
          - @status_options.each do |o|
            - selected = (o == @user.status ? "selected" : nil)
            %option{ selected: selected }= o
    %tr
      %td.header.meeting
        .wordwrap
          Zoom Date/Time
          %br
          %span.tzinfo (GMT)
      %td.user-meeting-datetime
        - datetime = @user.when_timestamp ? @user.when_timestamp.picker_datetime : nil
        %input.datetime-picker.utc-time{ type: "text", value: datetime }
    %tr
      %td.header Shadow
      %td.user-shadow
        = link_to((@user.shadow_greeter_id? ? @user.shadow_greeter.name : "I want to shadow"), "#")
    %tr
      %td.header Request Date
      %td.user-request= @user.request_timestamp ? @user.request_timestamp.human_date : nil
    %tr
      %td.header Notes
      %td.user-notes
        %textarea{ cols: "40" }= @user.notes
        %span.save-status
    %tr
      %td.header Questions
      %td.user-questions
        %ol
          - @user.questions_responses_array.each do |q, a|
            %li
              %span.question= q
              %br
              %span.answer= a
        - unless @user.joined? || @user.status == "Request Declined"
          - url = @user.email.blank? ? "#" : admin_approve_user_path(token: @user.token)
          = link_to "Approve", url, class: "btn btn-primary user-approve"
          = link_to "Reject", "#", class: "btn btn-warning user-reject"
          .lds-hourglass#spinner
          %span.progress-message Working ...
    %tr
      %td.header ChangeLog
      %td.change-log!= @user.change_log ? @user.change_log.gsub("\n","<br>") : "(no changes)"
    %tr.opt
      %td Admin
      %td
        = link_to "Generate Tokens", admin_user_token_url(token: @user.token, command: "generate")
        |
        = link_to "Regenerate Tokens", admin_user_token_url(token: @user.token, command: "regenerate")
        |
        = link_to "Revoke Tokens", admin_user_token_url(token: @user.token, command: "revoke")
        |
        - command_text = "#{@user.locked? ? "Unlock" : "Lock"} User"
        = link_to command_text, admin_user_token_url(token: @user.token, command: "toggle_lock")
